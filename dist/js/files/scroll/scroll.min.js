import{isMobile,getHash}from"../functions.js";import{gotoBlock}from"./gotoblock.js";let addWindowScrollEvent=!1;export function pageNavigation(){function t(t){if("click"===t.type){const e=t.target;if(e.closest("[data-goto]")){const o=e.closest("[data-goto]"),a=o.dataset.goto?o.dataset.goto:"",s=!!o.hasAttribute("data-goto-header"),i=o.dataset.gotoSpeed?o.dataset.gotoSpeed:500,c=o.dataset.gotoTop?parseInt(o.dataset.gotoTop):0;gotoBlock(a,s,i,c),t.preventDefault()}}else if("watcherCallback"===t.type&&t.detail){const e=t.detail.entry,o=e.target;if("navigator"===o.dataset.watch){document.querySelector("[data-goto]._navigator-active");let t;if(o.id&&document.querySelector(`[data-goto="#${o.id}"]`))t=document.querySelector(`[data-goto="#${o.id}"]`);else if(o.classList.length)for(let e=0;e<o.classList.length;e++){const a=o.classList[e];if(document.querySelector(`[data-goto=".${a}"]`)){t=document.querySelector(`[data-goto=".${a}"]`);break}}e.isIntersecting?t&&t.classList.add("_navigator-active"):t&&t.classList.remove("_navigator-active")}}}if(document.addEventListener("click",t),document.addEventListener("watcherCallback",t),getHash()){let t;document.querySelector(`#${getHash()}`)?t=`#${getHash()}`:document.querySelector(`.${getHash()}`)&&(t=`.${getHash()}`),t&&gotoBlock(t,!0,500,20)}}export function headerScroll(){addWindowScrollEvent=!0;const t=document.querySelector("header.header"),e=t.hasAttribute("data-scroll-show"),o=t.dataset.scrollShow?t.dataset.scrollShow:500,a=t.dataset.scroll?t.dataset.scroll:1;let s,i=0;document.addEventListener("windowScroll",(function(c){const d=window.scrollY;clearTimeout(s),d>=a?(!t.classList.contains("_header-scroll")&&t.classList.add("_header-scroll"),e&&(d>i?t.classList.contains("_header-show")&&t.classList.remove("_header-show"):!t.classList.contains("_header-show")&&t.classList.add("_header-show"),s=setTimeout((()=>{!t.classList.contains("_header-show")&&t.classList.add("_header-show")}),o))):(t.classList.contains("_header-scroll")&&t.classList.remove("_header-scroll"),e&&t.classList.contains("_header-show")&&t.classList.remove("_header-show")),i=d<=0?0:d}))}export function stickyBlock(){addWindowScrollEvent=!0,function(){const t=document.querySelectorAll("[data-sticky]");t.length&&t.forEach((t=>{let e={media:t.dataset.sticky?parseInt(t.dataset.sticky):null,top:t.dataset.stickyTop?parseInt(t.dataset.stickyTop):0,bottom:t.dataset.stickyBottom?parseInt(t.dataset.stickyBottom):0,header:t.hasAttribute("data-sticky-header")?document.querySelector("header.header").offsetHeight:0};!function(t,e){const o=t.querySelector("[data-sticky-item]"),a=e.header,s=a+e.top,i=o.getBoundingClientRect().top+scrollY-s;function c(a){const c=t.offsetHeight+t.getBoundingClientRect().top+scrollY-(s+o.offsetHeight+e.bottom);let d={position:"relative",bottom:"auto",top:"0px",left:"0px",width:"auto"};(!e.media||e.media<window.innerWidth)&&s+e.bottom+o.offsetHeight<window.innerHeight&&(scrollY>=i&&scrollY<=c?(d.position="fixed",d.bottom="auto",d.top=`${s}px`,d.left=`${o.getBoundingClientRect().left}px`,d.width=`${o.offsetWidth}px`):scrollY>=c&&(d.position="absolute",d.bottom=`${e.bottom}px`,d.top="auto",d.left="0px",d.width=`${o.offsetWidth}px`)),function(t,e){t.style.cssText=`position:${e.position};bottom:${e.bottom};top:${e.top};left:${e.left};width:${e.width};`}(o,d)}document.addEventListener("windowScroll",c)}(t,e)}))}()}setTimeout((()=>{if(addWindowScrollEvent){let t=new Event("windowScroll");window.addEventListener("scroll",(function(e){document.dispatchEvent(t)}))}}),0);